!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).L.Control.Layers.Tree=t()}(this,function(){"use strict";L.Control.Layers.Tree=L.Control.Layers.extend({options:{closedSymbol:"+",openedSymbol:"âˆ’",spaceSymbol:" ",selectorBack:!1,namedToggle:!1,collapseAll:"",expandAll:"",collapsed:!1},initialize:function(e,t,n){L.Util.setOptions(this,n),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._baseLayersList=L.DomUtil.create("div","leaflet-control-layers-list"),this._separator=L.DomUtil.create("div","leaflet-control-layers-separator"),this._overlaysList=L.DomUtil.create("div","leaflet-control-layers-list");for(var r in e)this._addLayer(e[r],r);for(var r in t)this._addLayer(t[r],r,!0)},onAdd:function(e){return this._initLayout(),this._update(),this._map=e,e.on("zoomend",this._checkDisabledLayers,this),this._container},addBaseLayer:function(e,t){return this._addLayer(e,t),this._map?this._update():this},addOverlay:function(e,t){return this._addLayer(e,t,!0),this._map?this._update():this},removeLayer:function(e){e.off("add remove",this._onLayerChange,this);var t=this._getLayer(L.Util.stamp(e));return t&&this._layers.splice(this._layers.indexOf(t),1),this._map?this._update():this},expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded"),this._form.style.height=null;var e=this._map.getSize().y-(this._container.offsetTop+50);return e<this._form.clientHeight?(L.DomUtil.addClass(this._form,"leaflet-control-layers-scrollbar"),this._form.style.height=e+"px"):L.DomUtil.removeClass(this._form,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return L.DomUtil.removeClass(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var e="leaflet-control-layers",t=this._container=L.DomUtil.create("div",e),n=this.options.collapsed;t.setAttribute("aria-haspopup",!0),L.DomEvent.disableClickPropagation(t),L.DomEvent.disableScrollPropagation(t);var r=this._form=L.DomUtil.create("form",e+"-list");n&&(this._map.on("click",this.collapse,this),L.Browser.android||L.DomEvent.on(t,{mouseenter:this.expand,mouseleave:this.collapse},this));var a=this._layersLink=L.DomUtil.create("a",e+"-toggle",t);a.href="#",a.title="Layers",L.Browser.touch?L.DomEvent.on(a,"click",L.DomEvent.stop).on(a,"click",this.expand,this):L.DomEvent.on(a,"focus",this.expand,this),n||this.expand(),this._baseLayersList=L.DomUtil.create("div",e+"-base",r),this._separator=L.DomUtil.create("div",e+"-separator",r),this._overlaysList=L.DomUtil.create("div",e+"-overlays",r),t.appendChild(r)},_getLayer:function(e){for(var t=0;t<this._layers.length;t++)if(this._layers[t]&&L.Util.stamp(this._layers[t].layer)===e)return this._layers[t]},_addLayer:function(e,t,n){this._map&&e.addTo(this._map),this._layers.push({layer:e,name:t,overlay:n}),e.on("add remove",this._onLayerChange,this)},_update:function(){if(!this._container)return this;L.DomUtil.empty(this._baseLayersList),L.DomUtil.empty(this._overlaysList),this._layerControlInputs=[];var e,t,n,r,a=0;for(n=0;n<this._layers.length;n++)r=this._layers[n],this._addItem(r),t=t||r.overlay,e=e||!r.overlay,a+=r.overlay?0:1;return this.options.hideSingleBase&&(e=e&&a>1,this._baseLayersList.style.display=e?"":"none"),this._separator.style.display=t&&e?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var t=this._getLayer(L.Util.stamp(e.target)),n=t.overlay?"add"===e.type?"overlayadd":"overlayremove":"add"===e.type?"baselayerchange":null;n&&this._map.fire(n,t)},_createRadioElement:function(e,t){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"'+(t?' checked="checked"':"")+"/>",r=document.createElement("div");return r.innerHTML=n,r.firstChild},_addItem:function(e){var t,n=document.createElement("label"),r=this._map.hasLayer(e.layer);e.overlay?((t=document.createElement("input")).type="checkbox",t.className="leaflet-control-layers-selector",t.defaultChecked=r):t=this._createRadioElement("leaflet-base-layers",r),t.layerId=L.Util.stamp(e.layer),L.DomEvent.on(t,"click",this._onInputClick,this);var a=document.createElement("span");a.innerHTML=" "+e.name,n.appendChild(t),n.appendChild(a);var s=e.overlay?this._overlaysList:this._baseLayersList;return s.appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){var e,t,n,r=this._form.querySelectorAll("input"),a=[],s=[];this._handlingClick=!0;for(var l=r.length-1;l>=0;l--)(e=r[l]).checked?a.push(this._getLayer(e.layerId)):e.checked||s.push(this._getLayer(e.layerId));for(l=0;l<s.length;l++)this._map.hasLayer(s[l].layer)&&this._map.removeLayer(s[l].layer);for(l=0;l<a.length;l++)t=a[l],this._map.hasLayer(t.layer)||this._map.addLayer(t.layer),t.overlay||((n=n||this._map._layersMaxZoom||1/0)==1/0&&(n=Number.MAX_VALUE),t.layer.options&&(n=Math.min(n,void 0===t.layer.options.maxZoom?Number.MAX_VALUE:t.layer.options.maxZoom)),this._map.getZoom()>n&&this._map.setZoom(n));this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var e,t,n=this._form.querySelectorAll("input"),r=this._map.getZoom(),a=n.length-1;a>=0;a--)(e=n[a]).disabled="",(t=this._getLayer(e.layerId).layer).options&&void 0!==t.options.minZoom&&r<t.options.minZoom&&(e.disabled="disabled"),t.options&&void 0!==t.options.maxZoom&&r>t.options.maxZoom&&(e.disabled="disabled")},_expandCollapseAll:function(e){this._handlingClick=!0;for(var t=this._form.querySelectorAll("input"),n=t.length-1;n>=0;n--)if("checkbox"===t[n].type){t[n].checked=e;var r=this._getLayer(t[n].layerId);e?this._map.hasLayer(r.layer)||this._map.addLayer(r.layer):this._map.hasLayer(r.layer)&&this._map.removeLayer(r.layer)}this._handlingClick=!1,this._refocusOnMap()},_expand:function(){return L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded"),this},_collapse:function(){return this._container.className=this._container.className.replace(" leaflet-control-layers-expanded",""),this}});
